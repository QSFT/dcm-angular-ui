"use strict";angular.module("dcm-ui.grid",[]),angular.module("dcm-ui.grid").controller("DCMGridCtrl",["$scope","$compile","$log","$interpolate","$timeout","$q",function(e,t,n,a,r,o){var i=this,l=[],c=[];e.storeConfig&&localStorage[e.storeConfig]&&(n.info("GRID: attempting to load grid config from local storage"),c=JSON.parse(localStorage[e.storeConfig])),e.hasOwnProperty("columns")&&angular.isArray(e.columns)&&(l=e.columns);var d=i.columns=e.columns=[];e.hasOwnProperty("editColumns")&&(e.editColumns=d,e.editColumns.update=function(){i.redrawGrid()}),i.rowActionContent="",i.oRowActions=void 0,i.headerRow="",i.aRows=[];var s=0,u={};i.getGridDataID=function(t){return t.hasOwnProperty("$$gridDataID")||(s++,t.$$gridDataID=e.$id+"-"+s.toString()),t.$$gridDataID},i.getGridData=function(e){var t=i.getGridDataID(e);return u.hasOwnProperty(t)?u[t]:null},i.putGridData=function(e,t){u[e]=t},i.addColumn=function(e){var t=_.where(c,{title:e.title,content:e.content});t.length||(t=_.where(l,{title:e.title,content:e.content})),t.length&&(e.sortDefault=t[0].sortDefault,e.width=t[0].width,e.enabled=t[0].enabled),d.push(e)},i.redrawGrid=function(){i.tableBody.empty(),i.tableHead.empty(),i.tableHead.append(i.generateHeaderRow()),i.generateTemplates(),t(i.tableHead)(e);for(var a=0,r=i.aRows.length;r>a;a++){var o=i.aRows[a],l=i.getGridData(o);l.row=i.rowTemplate(l.scope,angular.noop),l.checkbox=l.row.find("td.dcm-grid-selectable i"),i.tableBody.append(l.row)}n.info("GRID: templates regenerated + table updated"),i.storeConfig()},i.getColWidthPct=function(e){return Math.round(e.outerWidth(!0)/i.headerRow.width()*1e4)/100},e.$on("TABLE_COL_RESIZED",function(){var e=0,t=i.headerRow.children();i.bEnableActive&&e++,angular.forEach(i.columns,function(n){if(n.enabled){var a=angular.element(t[e]);n.width=i.getColWidthPct(a).toString()+"%",e++}}),i.storeConfig()}),i.storeConfig=function(){if(e.storeConfig){var t=_.map(d,function(e){return{width:e.width,sortDefault:e.sortDefault,enabled:e.enabled,title:e.title,content:e.content}});localStorage[e.storeConfig]=JSON.stringify(t),n.info("GRID: grid config saved to local storage")}},i.oRowAttributes={},i.addRowAttributes=function(e){angular.extend(i.oRowAttributes,e)},i.oRowActionsAttributes={},i.addRowActionsAttributes=function(e){angular.extend(i.oRowActionsAttributes,e)},i.getSelectedAsArray=function(){if("single"===i.selectType){var t=[];return e.selected&&t.push(e.selected),t}return e.selected},i.selectedPosition=function(e){return _.indexOf(i.getSelectedAsArray(),e.data)},i.toggleSelected=function(t){var n,a,r;if(t)for(a=0,r=e.datasource.length;r>a;a++)n=i.getGridData(e.datasource[a]),n.checkbox.hasClass(i.checkedIcon)||i.addSelected(n);else for(a=e.selected.length-1;a>=0;a--)n=i.getGridData(e.selected[a]),i.removeSelected(n)},i.addSelected=function(t){"single"===i.selectType?(e.selected&&e.selected!==t.data&&i.removeSelected(i.getGridData(e.selected)),e.selected=t.data):e.selected.push(t.data),t.scope.$row.checked=!0,i.bEnableActive&&i.oRowActions&&e.activeRow===t.data&&i.oRowActions.addClass("selected")},i.removeSelected=function(t){"single"===i.selectType?e.selected=null:e.selected.splice(i.selectedPosition(t),1),t.scope.$row.checked=!1,i.bEnableActive&&i.oRowActions&&e.activeRow===t.data&&i.oRowActions.removeClass("selected")},i.mergeAttributes=function(e,t){angular.forEach(t,function(t,n){"ng-class"===n&&e.attr("ng-class")?e.attr(n,(e.attr("ng-class")+t).replace(/}\s*{/,", ")):e.attr(n,t)})},i.rowTemplate=angular.noop,i.activeRowTemplate=angular.noop,i.generateTemplates=function(){var e,n,a=angular.element('<tr ng-class="{selected: $row.checked}">'),r=0;i.mergeAttributes(a,i.oRowAttributes);for(var o=0,l=i.columns.length;l>o;o++)e=i.columns[o],e.enabled&&(r++,n=angular.element("<td>"),n.append(e.content),i.mergeAttributes(n,e.attributes),a.append(n));if(i.bEnableSelect){var c="{'"+i.checkedIcon+"': $row.checked, '"+i.notCheckedIcon+"': !$row.checked }",d=angular.element('<i class="fa" ng-class="'+c+'"></i>');a.append(angular.element('<td ng-click="toggleChecked($row, $event);" class="dcm-grid-selectable"></td>').append(d))}if(i.bEnableActive){a.attr("ng-click","toggleActiveRow($row)");var s=angular.element('<td class="dcm-grid-activemarker"></td>');i.bRowStatus&&s.html(i.rowStatusContent),a.prepend(s)}else i.bEnableSelect&&a.attr("ng-click","toggleChecked($row, $event)");if(i.rowTemplate=t(a),i.bRowActions){var u=angular.element('<tr class="dcm-grid-details">');i.mergeAttributes(u,i.oRowActionsAttributes);var f=angular.element('<td ng-click="" colspan="'+r+'">').html(i.rowActionContent);i.bEnableActive&&u.append(angular.element('<td class="dcm-grid-activemarker"></td>')),u.append(f),i.bEnableSelect&&u.append(angular.element("<td></td>")),i.activeRowTemplate=t(u)}},i.generateHeaderRow=function(){i.colCount=0;for(var n=-1,r=0;r<i.columns.length;r++)i.columns[r].enabled&&(n=r);var o=angular.element("<tr>");if(angular.forEach(i.columns,function(n){if(n.enabled){n.icon="",i.colCount++;var r,l=e.$new(!1);l.column=n,r=t('<a>{{column.title}}<i class="fa" ng-if="column.icon" ng-class="column.icon"></a>')(l);var c=angular.element('<th class="resizable-column">').append(r);if(c.css("width",n.width?n.width:"auto"),i.sortable){var d;if(n.field)if(n.field.match(/\./)){var s=n.field.split(".");d=function(e){for(var t=e,n=0;n<s.length;n++){var a=s[n];if(!t.hasOwnProperty(a))return;t=t[a]}return t}}else d=function(e){return e[n.field]};else d=a(n.content);switch(n.sortType){case"string":n.sortFunction=function(e){var t=d(e)||"";return t.toLowerCase()};break;case"integer":n.sortFunction=function(e){var t=d(e);return t=t?t:0,parseInt(t,10)};break;case"datetime":n.sortFunction=function(e){var t=new Date(d(e));return t.getTime()};break;case"direct":n.sortFunction=d;break;default:var u;n.sortFunction=function(e){var t=d(e);switch(u||(u=typeof t,"string"===u&&t.match(/^\d{4,4}-\d\d-\d\dT\d\d:\d\d:\d\dZ$/)&&(u="datetime")),u){case"string":return t?t.toLowerCase():"";case"datetime":return t?t:"";default:return t?t:""}}}n.sortDefault&&(e.sortFunction=n.sortFunction,i.currentSort&&i.currentSort!==n&&(i.currentSort.sortDefault=!1),i.currentSort=n,e.sortOrder=n.sortDefault.toUpperCase(),"ASC"===e.sortOrder?n.icon="fa-angle-up":n.icon="fa-angle-down"),c.bind("click",function(){e.$apply(function(){i.currentSort?(i.currentSort.icon="",i.currentSort===n&&"DESC"!==e.sortOrder?(e.sortOrder="DESC",n.icon="fa-angle-down"):(e.sortOrder="ASC",n.icon="fa-angle-up")):(e.sortOrder="ASC",n.icon="fa-angle-up"),i.currentSort!==n&&(i.currentSort&&(i.currentSort.sortDefault=!1),e.sortFunction=n.sortFunction,i.currentSort=n),i.currentSort.sortDefault=e.sortOrder,i.storeConfig()})})}o.append(c)}}),i.bEnableSelect){i.colCount++;var l=angular.element('<th class="dcm-grid-selectable"></th>');if("single"!==i.selectType){var c=angular.element('<i class="fa fa-square-o">');c.bind("click",function(){e.$apply(function(){var e=c.hasClass(i.checkedIcon);i.toggleSelected(!e)})}),l.append(c),i.unbindBulkCheck&&i.unbindBulkCheck(),i.unbindBulkCheck=e.$watchCollection("selected",function(e){var t=e.length&&e.length===i.aRows.length;c.removeClass("fa-check-square-o fa-square-o").addClass(t?i.checkedIcon:i.notCheckedIcon)})}o.append(l)}return i.bEnableActive&&(i.colCount++,o.prepend(angular.element('<th class="dcm-grid-activemarker"></th>')),e.$watch("activeRow",function(e,t){void 0!==t&&i.removeActiveRow(t),i.setActiveRow(e)})),i.headerRow=o,o},i.removeActiveRow=function(t){if(t=t||e.activeRow){var n=i.getGridData(t);n&&n.row&&(n.row.removeClass("active"),i.bRowActions&&(n.scope.$row.open=!1,n.scope.$row.closed=!0)),e.activeRow=void 0}i.oRowActions&&i.oRowActions.remove()};var f=function(t){if(t&&t.hasOwnProperty("row"))if(i.bRowActions){var n=i.activeRowTemplate(t.scope,angular.noop);if(i.bEnableSelect&&-1!==i.selectedPosition(t)&&n.addClass("selected"),i.oRowActions=n,!i.rowOpener||i.bRowLoaderRememberOpened&&t.scope.$row.openCached)t.row.addClass("active"),t.row.after(i.oRowActions),t.scope.$row.open=!0,t.scope.$row.closed=!1;else{var a=i.rowOpener(t.data);g(t,a),o.when(a).then(function(n){i.updateRowData(t,n),i.bRowLoaderRememberOpened&&(t.scope.$row.openCached=!0),e.activeRow===t.data&&(t.row.addClass("active"),t.scope.$row.open=!0,t.scope.$row.closed=!1,t.row.after(i.oRowActions))})}}else t.row.addClass("active");else i.removeActiveRow()};i.updateRowData=function(e,t){angular.extend(e.data,t),angular.extend(e.scope,t)};var g=function(e,t){e.row.addClass("data-loading"),e.scope.$row.dataLoading=!0;var n=r(function(){e.scope.$row.showLoading=!0,e.row.addClass("show-loading")},i.rowLoadingDelay);o.when(t)["finally"](function(){r.cancel(n),e.row.removeClass("data-loading"),e.row.removeClass("show-loading"),e.scope.$row.dataLoading=!1,e.scope.$row.showLoading=!1})};i.reloadTrigger=function(e){var t=_.findWhere(i.aRows,e);if(t){t=i.getGridData(t);var n=i.reloadRow(t.data);g(t,n),o.when(n).then(function(e){i.updateRowData(t,e),t.scope.$row.openCached=!1})}},i.setActiveRow=function(t){if(i.removeActiveRow(),t){e.activeRow=t;var n=i.getGridData(t);n&&n.hasOwnProperty("row")?f(n):r(function(){f(n)},0)}},e.$on("$destroy",function(){if(i.bEnableActive&&e.activeRow&&i.removeActiveRow(),i.bEnableSelect)for(var t=i.getSelectedAsArray(),n=t.length-1;n>=0;n--){var a=i.getGridData(t[n]);i.removeSelected(a)}})}]),angular.module("dcm-ui.grid").directive("dcmGridColumn",[function(){return{require:"^dcmGrid",restrict:"E",scope:{field:"@",title:"@",width:"@",enabled:"@",sortType:"@",sortDefault:"@",resizable:"@"},compile:function(e,t){var n=$.trim(e.html());return function(e,a,r,o){var i={};angular.forEach(r,function(t,n){"$"!==n[0]&&void 0===e[n]&&""!==t&&(i[n.replace(/([A-Z])/g,"-$1").toLowerCase()]=t)});var l={content:n,attributes:i,enabled:void 0!==r.enabled?"false"!==r.enabled.toLowerCase():!0,title:e.title,width:e.width,resizable:void 0!==r.resizable?"false"!==r.resizable.toLowerCase():!0,field:r.field,sortType:e.sortType||"",sortDefault:void 0!==r.sortDefault?r.sortDefault||"ASC":!1};if(!r.field||""===r.field){var c=n.match(/^\s*{{\s*(\S+)\s*}}\s*$/);c&&(l.field=c[1])}void 0===t.title&&l.field&&""!==l.field&&(l.title=l.field[0].toUpperCase()+l.field.slice(1)),o.addColumn(l)}}}}]),angular.module("dcm-ui.grid").directive("dcmGrid",["$animate","$log","$compile","$window",function(e,t,n,a){return{restrict:"E",require:"dcmGrid",scope:{datasource:"=",activeRow:"=?",selected:"=?",additionalRowData:"=?",sortFunction:"=?",sortOrder:"=?",editColumns:"=?",storeConfig:"@",openRow:"=?",reloadRow:"=?",reloadTrigger:"=?",cacheOpenedRows:"@?",loadingDelay:"@?"},controller:"DCMGridCtrl",compile:function(){return function(r,o,i,l){l.bEnableSelect=!!i.selected,l.bEnableActive=!!i.activeRow,l.sortable=!!i.sortFunction,l.selectType=i.selectType?i.selectType.toLowerCase():"multiple","multiple"===l.selectType?(l.checkedIcon="fa-check-square-o",l.notCheckedIcon="fa-square-o"):(l.checkedIcon="fa-dot-circle-o",l.notCheckedIcon="fa-circle-o"),l.reloadRow=r.reloadRow,r.reloadTrigger=l.reloadTrigger,l.rowOpener=r.openRow,void 0!==r.loadingDelay&&r.loadingDelay.match(/^\d+$/)?l.rowLoadingDelay=parseInt(r.loadingDelay,10):l.rowLoadingDelay=500,void 0!==r.cacheOpenedRows&&"false"===r.cacheOpenedRows.toLowerCase()?l.bRowLoaderRememberOpened=!1:l.bRowLoaderRememberOpened=!0,r.additionalRowData&&(l.additionalRowData=r.additionalRowData);var c=l.tableHead=angular.element("<thead>"),d=l.tableBody=angular.element("<tbody>"),s=l.table=angular.element('<table class="dcm-grid-table resizable-columns">');i.width&&s.css("width",i.width),s.addClass(l.bRowActions?"has-row-actions":"no-row-actions"),s.append(c),c.append(l.generateHeaderRow()),n(s)(r),l.generateTemplates();var u=[],f={};l.bEnableSelect&&"single"===l.selectType&&r.$watch("selected",function(e,t){var n;e!==t&&(t&&(n=l.getGridData(t),n&&l.removeSelected(n)),e&&(n=l.getGridData(e),n?l.addSelected(n):r.selected=null))}),r.$watchCollection("datasource",function(n){var o=(new Date).getTime();l.aRows=n;var i,c=[];if(_.isArray(n)||(n=[]),l.bEnableActive&&r.activeRow&&(-1!==_.indexOf(n,r.activeRow)&&(t.info("GRID: storing active row to reopen later"),i=r.activeRow),l.removeActiveRow()),l.bEnableSelect){c=l.getSelectedAsArray();for(var s=c.length-1;s>=0;s--)if(-1===_.indexOf(n,c[s])){var m=l.getGridData(c[s]);m?l.removeSelected(m):"single"===l.selectType?r.selected=null:r.selected.splice(s,1)}}r.toggleActiveRow=function(e){var t=a.getSelection().toString();t||(r.activeRow===e.data?r.activeRow=void 0:r.activeRow=e.data)},r.toggleChecked=function(e,t){e.checked=!e.checked,e.checked?l.addSelected(e.record):l.removeSelected(e.record),t.stopPropagation()};for(var h,v,w,b,C=[],D={},$=function(e,t){var n=this;n[t]=e,n.$watch(function(){return n.$$gridData[t]},function(e){e!==n[t]&&(n[t]=e)})},y=0,R=n.length;R>y;y++){var A=n[y];if(h=l.getGridDataID(A),v=l.getGridData(A),!v||!_.isEqual(v.lastValue,A)){var S=r.$new(!1),x=A,E={};S.$$gridData=n[y],angular.forEach(A,$,S),l.additionalRowData&&angular.extend(S,l.additionalRowData),S.$row={checked:-1!==_.indexOf(c,x)?!0:!1,data:x,record:E,dataLoading:!1,showLoading:!1,openCached:!1,open:!1,closed:l.bRowActions?!0:!1},angular.extend(E,{scope:S,data:x,lastValue:_.clone(x),id:h}),l.putGridData(h,E),l.bEnableActive&&r.activeRow===x&&l.setActiveRow(x.data),v=E}D[h]=C.length,C.push(v)}for(y=u.length-1;y>=0;y--)v=u[y],D.hasOwnProperty(v.id)||(w=f[v.id],delete f[v.id],u.splice(w,1),y-1<u.length-1&&p(y,u.length),e.leave(v.row));for(y=0,R=C.length;R>y;y++)v=C[y],u.length>=y&&u[y]===v||(f.hasOwnProperty(v.id)?(0===y?e.move(v.row,d,null):e.move(v.row,d,u[y-1].row),b=f[v.id],u.splice(b,1),u.splice(y,0,v),f[v.id]=y,g(y+1,b+1)):(v.row=l.rowTemplate(v.scope,angular.noop),v.checkbox=v.row.find("td.dcm-grid-selectable i"),0===y?e.enter(v.row,d,null):e.enter(v.row,d,u[y-1].row),u.splice(y,0,v),f[v.id]=y,y+1<u.length&&g(y+1,u.length)));i&&(t.info("GRID: restoring active row"),l.setActiveRow(i));var O=(new Date).getTime()-o;t.info("GRID: Update after data change "+O+"ms")});var g=function(e,t){_.each(_.range(e,t),function(e){f[u[e].id]++})},p=function(e,t){_.each(_.range(e,t),function(e){f[u[e].id]--})};s.append(d),o.empty().append(s)}}}}]),angular.module("dcm-ui.grid").directive("dcmGridRowActions",[function(){return{require:"^dcmGrid",restrict:"E",scope:!1,compile:function(e){return function(t,n,a,r){r.rowActionContent=$.trim(e.html()),r.bRowActions=!0;var o={};angular.forEach(a,function(e,n){"$"!==n[0]&&void 0===t[n]&&""!==e&&(o[n.replace(/([A-Z])/g,"-$1").toLowerCase()]=e)}),r.addRowActionsAttributes(o)}}}}]),angular.module("dcm-ui.grid").directive("dcmGridRow",[function(){return{require:"^dcmGrid",restrict:"E",scope:!1,compile:function(){return function(e,t,n,a){var r={};angular.forEach(n,function(t,n){"$"!==n[0]&&void 0===e[n]&&""!==t&&(r[n.replace(/([A-Z])/g,"-$1").toLowerCase()]=t)}),a.addRowAttributes(r)}}}}]),angular.module("dcm-ui.grid").directive("dcmGridRowStatus",[function(){return{require:"^dcmGrid",restrict:"E",scope:!1,compile:function(e){return function(t,n,a,r){r.bRowStatus=!0,r.rowStatusContent=$.trim(e.html())}}}}]),angular.module("dcm-ui.grid").factory("datasource",["$timeout","$q","$log","$http",function(e,t,n,a){var r={create:function(r,o){var i,l,c,d,s,u,f,g,p,m,h,v,w=null,b={type:"get"},C={perPage:5};o.hasOwnProperty("autoLoad")||(o.autoLoad=!0),o.hasOwnProperty("requestDataFunction")||(o.requestDataFunction=function(n){var r=t.defer(),o=function(){a(n).then(function(t){var a=t.data;r.notify(a.hasOwnProperty("data")?a.data:a),a.complete||!a.hasOwnProperty("complete")?r.resolve():a.hasOwnProperty("complete")&&a.token&&(n.hasOwnProperty("params")||(n.params={}),n.params.token=a.token,e(function(){o()},250))},r.reject)};return o(),r.promise});var D=function(){if(h&&E.data.length){E.bFiltering=!0;var e=new Date;"ASC"!==E.sortOrder&&E.data.reverse(),E.data=_.sortBy(E.data,h),"ASC"!==E.sortOrder&&E.data.reverse();var t=new Date-e;n.info("DATASOURCE: Sort "+t+"ms"),E.bPaused?("ASC"!==E.sortOrder&&E.viewData.reverse(),E.viewData=_.sortBy(E.viewData,h),"ASC"!==E.sortOrder&&E.viewData.reverse(),x(),E.bFiltering=!1):S()}};r.$watch(function(){return E.sortFunction},function(e){h=e,D()});var $;r.$watch(function(){return E.sortOrder},function(e){("DESC"===e||$&&$===h)&&(E.data.reverse(),E.viewData.reverse(),x(),E.bFiltering=!1),$=h}),o.hasOwnProperty("pagination")&&(g=angular.extend({},C,o.pagination),s=r.$watchCollection(function(){return o.pagination},function(e){g=angular.extend(g,e),x()})),r.$watchCollection(function(){return o.request},function(e){d&&d(),u=angular.extend({},b,e),u.hasOwnProperty("params")&&(d=r.$watchCollection(function(){return o.request.params},function(e){u.params=e,E.bOptionsValid&&o.autoLoad&&y()})),E.bOptionsValid&&o.autoLoad&&y()}),r.$on("$destroy",function(){f&&f.resolve()});var y=_.debounce(function(){n.info("DATASOURCE: Starting new data load"),e(function(){if(E.bOptionsValid&&E.bFilterValid){if(E.bLoading){if(angular.equals(E.currentRequestOptions,u))return;f.resolve()}v=!0,E.bLoading=!0,E.data=[],E.pageData=[],E.viewData=[],E.pages=0,f=t.defer(),u.timeout=f.promise,E.currentRequestOptions=angular.copy(u);var a=!0,r=0,i=0,l=o.requestDataFunction(u),c=new Date;l.then(function(){E.bLoading=!1,a&&(h?D():(E.bFiltering=!0,S())),t.when(w).then(function(){var t=new Date-c;if(n.info("DATASOURCE: Complete loading time: "+t+"ms"),v=!1,o.hasOwnProperty("onLoadComplete")){var a=new Date;e(function(){o.onLoadComplete();var e=new Date-a;n.info("DATASOURCE: Load complete function: "+e+"ms")},0)}})},function(){n.warn("DATASOURCE: Request cancelled"),E.bLoading=!1,E.bFiltering=!1,v=!1},function(e){var t=new Date;E.data.push.apply(E.data,e);var o=new Date-t;n.info("DATASOURCE: Loading new data: "+o+"ms"),1e3>r?(h?D():(E.bFiltering=!0,S()),a=!1,i=t,r=new Date-t):(a=!0,n.info("DATASOURCE: skipping sort/filter due to previous process time"),r-=new Date-i),i=t})}},0)},100);o.hasOwnProperty("requestValid")&&o.requestValid&&r.$watch(o.requestValid,function(e){E.bOptionsValid=!!e,E.bOptionsValid&&o.autoLoad&&y()});var R=null,A=null,S=function(){return A?e.cancel(R):A=t.defer(),w=A.promise,R=e(function(){var e,t,a=0,r=[];if(E.bPaused){if(i){for(t=E.viewData.length;t>a;a++)e=E.viewData[a],i(e)&&r.push(e);E.viewData=r}}else{var o=new Date;if(i){for(t=E.data.length;t>a;a++)e=E.data[a],i(e)&&r.push(e);E.viewData=r}else E.viewData=E.data.slice(0);x(),E.bFiltering=!1;var l=new Date-o;n.info("DATASOURCE: Filter "+l+"ms")}A.resolve(),A=null},100),w},x=function(){g?(g.perPage=parseInt(g.perPage,10),(!g.perPage||g.perPage<=0)&&(g.perPage=C.perPage),E.pages=Math.ceil(E.viewData.length/g.perPage),E.currentPage=Math.min(E.currentPage,E.pages),E.currentPage<=0&&(E.currentPage=Math.min(1,E.pages)),p=g.perPage*(E.currentPage-1),m=Math.min(p+g.perPage,E.viewData.length),E.pageData=E.viewData.slice(p,m)):(E.pageData=E.viewData,E.viewData.length?(E.pages=1,E.currentPage=1):(E.pages=0,E.currentPage=0))},E={bLoading:!1,bFiltering:!1,bFilterValid:!0,bOptionsValid:!0,bPaused:!1,initialRequestOptions:o.request,currentRequestOptions:{},currentPage:0,data:[],viewData:[],pageData:[],pages:0,sortFunction:null,sortOrder:"ASC",setPage:function(e){E.currentPage=e,x()},loadData:function(){E.bPaused=!1,y()},cancelRequest:function(){f&&f.resolve()},pause:function(){E.bPaused=!0,E.bFiltering=!1},resume:function(){E.bPaused=!1,E.bFiltering=!0,S()}};return o.hasOwnProperty("filter")&&(i=o.filter.filterFunction,o.hasOwnProperty("filterValid")&&(c=r.$watch(o.filterValid,function(e){E.bFilterValid=!!e,!E.bLoading&&E.bFilterValid&&(E.bFiltering=!0,S())})),l=r.$watchCollection(function(){return o.filter.values},function(){E.bFilterValid&&(E.bFiltering=!0,S())})),E}};return r}]),angular.module("dcm-ui.grid").factory("filters",["$interpolate",function(e){var t=function(e){return void 0===e?"":e},n=function(e,t){var n={},a=[];if(n[t]=!0,e&&angular.isArray(e)&&e.length)for(var r=0;r<e.length;r++)n[e[r]]=!0;for(var o in n)a.push(o);return a},a={"new":function(a){var r={data:{},defaultValues:{},defaultParams:{},values:{},requestParams:{},filterFunctions:[]};return r.resetFilters=function(){angular.extend(r.values,r.defaultValues),angular.extend(r.requestParams,r.defaultParams)},r.addDefaultValue=function(e,n){r.defaultValues[e]=t(n),r.values[e]=r.defaultValues[e]},r.addDefaultParam=function(e,n){r.defaultParams[e]=t(n),r.requestParams[e]=r.defaultParams[e]},r.onChange=function(e,t,n){a.$watch(function(){return r[e][t]},n)},r.onCollectionChange=function(e,t,n){a.$watchCollection(function(){return r[e][t]},n)},r.addFilterExactMatchObject=function(e,t){r.filterFunctions.push(function(n,a){return r.data[t]&&!r.data[t][a[e]]?!1:!0})},r.addFilterInteger=function(e,t){var n;switch(t){case"lt":n=function(e,t){return t>e};break;case"gt":n=function(e,t){return e>t};break;case"eq":n=function(e,t){return e===t}}r.filterFunctions.push(function(t,a){return""===t[e]||n(parseInt(a[e],10),parseInt(t[e],10))?!0:!1})},r.addFilterExactMatch=function(e,t){var n=function(e,t){return e&&e.toString().toLowerCase()===t.toString().toLowerCase()?!0:!1};r.addFilterWithComparator(n,e,t)},r.addFilterPartialMatch=function(e,t){var n=function(e,t){return e&&-1!==e.toString().toLowerCase().indexOf(t.toString().toLowerCase())?!0:!1};r.addFilterWithComparator(n,e,t)},r.addFilterPartialMatchFromStart=function(e,t){var n=function(e,t){return e&&0===e.toString().toLowerCase().indexOf(t.toString().toLowerCase())?!0:!1};r.addFilterWithComparator(n,e,t)},r.addFilterWithComparator=function(t,a,o){var i,l;o&&!angular.isArray(o)?i=e(o):l=n(o,a),r.filterFunctions.push(function(e,n){if(""!==e[a]){var r,o=e[a];if(i){if(r=i(n),t(r,o))return!0}else for(var c=0;c<l.length;c++)if(r=n[l[c]],t(r,o))return!0;return!1}return!0})},r.addFilterWhenValueIs=function(e,t){t=t.toString(),r.filterFunctions.push(function(n,a){return n[e]&&n[e].toString()===t&&a[e].toString()!==t?!1:!0})},r.setData=function(e,t){r.data[e]=t},r.filterFunction=function(e){for(var t=!0,n=angular.extend({},r.requestParams,r.values),a=0,o=r.filterFunctions.length;o>a;a++){if(!t)return t;t=r.filterFunctions[a](n,e)}return t},r.addStandardTextSearchFilter=function(e,t){r.addDefaultValue(e,""),r.addFilterPartialMatch(e,t)},r.addExactTextSearchFilter=function(e,t){r.addDefaultValue(e,""),r.addFilterExactMatch(e,t)},r.addTextSearchMatchFromStartFilter=function(e,t){r.addDefaultValue(e,""),r.addFilterPartialMatchFromStart(e,t)},r}};return a}]);
//# sourceMappingURL=dcm-ui-grid.min.js.map