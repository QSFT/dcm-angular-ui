"use strict";angular.module("dcm-ui.resizable-cols",["dcm-ui.helpers.drag"]),angular.module("dcm-ui.resizable-cols").controller("ResizableColumnsCtrl",["$timeout",function(e){var t=this,n=t.cols=[],i=[],a=t.autoCols=[],r=[];t.dragBox=angular.element('<div class="resizable-columns-drag-box" style="position: absolute;">'),t.dragBox.on("click",function(e){e.stopPropagation(),e.preventDefault()});var o=!1;t.addAutoCol=function(n){a.push(n),r.push(n),o||(o=!0,e(t.resizeAll,0))},t.addCol=function(a,l){n.push(a),r.push(a),i.push(l),o||(o=!0,e(t.resizeAll,0))},t.removeCol=function(e){var t=n.indexOf(e);t>-1?(n.splice(t,1),i.splice(t,1)):(t=a.indexOf(e),a.splice(t,1)),t=r.indexOf(e),r.splice(t,1)},t.resizeAll=function(){var e,i,l=0,u=0,s=[];for(e=0;e<r.length;e++)i=r[e].width(),s.push(i),i<t.minimumWidth&&(l+=t.minimumWidth-i,u++);var c=l/(r.length-u),d=0;for(e=0;e<r.length;e++)if(i=s[e],i<t.minimumWidth)r[e].width(t.minimumWidth),d+=t.minimumWidth-i,s[e]=t.minimumWidth;else{var f=Math.min(i-t.minimumWidth,c);r[e].width(i-f),d-=f,s[e]=i-f}if(d>0)for(e=0;e<r.length;e++)if(i=s[e],d&&i>t.minimumWidth){var m=Math.min(i-t.minimumWidth,d);r[e].width(i-m),d-=m,s[e]=i-m}var p=t.table.outerWidth(!0);for(e=0;e<n.length;e++){var g=n[e],h=(Math.round(g.outerWidth(!0)/p*1e4)/100).toString()+"%";g.css("width",h)}for(e=0;e<a.length;e++)a[e].css("width","auto");o=!1}}]),angular.module("dcm-ui.resizable-cols").directive("resizableColumn",["$log","$document","$timeout","dragHelper",function(e,t,n,i){return{restrict:"AC",scope:!1,require:"^resizableColumns",compile:function(){return function(t,a,r,o){var l=a.next();if(!l.length||!l.hasClass("resizable-column")&&void 0===l.attr("resizable-column"))a.removeClass("resizable-column"),a.css("width","auto"),o.addAutoCol(a);else{a.addClass("resizable-column");var u=angular.element('<a class="resizable-columns-drag-handle"></a>');u.css({cursor:"col-resize",position:"absolute",display:"block",width:"10px"}),o.addCol(a,u);var s=function(){u.height(a.outerHeight(!1));var e=l.offset(),t=e.left-u.width()/2;u.offset({top:e.top,left:t})},c=t.$watch(function(){return l[0].offsetLeft+o.table[0].offsetLeft},function(t,n){t!==n&&Math.abs(n-t)>=1&&(e.info("RESIZABLE: position changed: "+a.text()+" "+(Math.round(100*(n-t))/100).toString()+"px"),s())});n(function(){o.table.after(u),s()},0);var d,f,m,p=function(){var e=a.width(),t=l.width(),n=e+t,i=Math.round(g(a)),r=Math.round(g(l)),o=n-r;return{current:e,currentNext:t,combined:n,min:i,minNext:r,max:o,nextResizable:l.is(".resizable-column")}},g=function(e){var t=angular.element('<span style="display:inline; padding: 0; margin: 0;">');e.append(t),t.append(e.contents());var n=t.outerWidth(!0);return e.append(t.contents()),t.remove(),n},h=function(e,t){return Math.round(Math.min(Math.max(t.current+e.dX,t.min),t.max))},v=function(e){var t=p(),n=h(e,t)-t.current;o.dragBox.offset({top:f,left:n}),u.offset({left:d.left+n})},w=function(e){o.dragBox.remove(),a.removeClass("resizing"),u.removeClass("resizing");var t=p();b(h(e,t)),s()},b=function(e){var n=p(),i=n.combined-e;Math.abs(e-n.current)>=1&&(e<n.current||!n.nextResizable?(a.width(e),i=n.combined-a.width(),n.nextResizable&&a.width()!==n.current&&l.width(i)):(l.width(i),e=n.combined-l.width(),l.width()!==n.currentNext&&a.width(e)),t.$emit("TABLE_COL_RESIZED"))},y=function(){var t=p();return t.combined<=t.min+t.minNext?(e.info("RESIZABLE: both cols are too narrow to resize further"),!1):(d=u.offset(),m=Math.round(l.offset().left-1),a.addClass("resizing"),u.addClass("resizing"),o.table.after(o.dragBox),f=o.table.offset().top,o.dragBox.height(o.table.height()).width(m).offset({top:f,left:0}),void 0)},$=function(){var t=p();if(t.combined<=t.min+t.minNext)e.info("RESIZABLE: both cols are too narrow to resize further");else{b(t.max);var n=a.parent().children().index(a),i=Math.min(g(a),t.max),r=o.table.find("tbody>tr>td:nth-child("+(n+1).toString()+")");angular.forEach(r,function(e){i=Math.max(i,Math.min(g(angular.element(e)),t.max))}),b(i)}};i.draggable(u,{dragCursor:"col-resize",mouseUp:w,mouseDown:y,mouseMove:v,mouseDoubleClick:$}),a.on("$destroy",function(){c(),o.removeCol(a),u.remove()})}}}}}]),angular.module("dcm-ui.resizable-cols").directive("resizableColumns",[function(){return{restrict:"AC",controller:"ResizableColumnsCtrl",compile:function(){return function(e,t,n,i){t.addClass("resizable-columns"),i.table=t,i.visible=!1,n.columnMinWidth?i.minimumWidth=parseInt(n.columnMinWidth,10):i.minimumWidth=10,e.$watch(function(){return t[0].offsetWidth},function(e){i.visible=!!e})}}}}]);
//# sourceMappingURL=dcm-ui-resizable-cols.min.js.map