"use strict";angular.module("dcm-ui.select2",[]),angular.module("dcm-ui.select2").constant("SELECT2",{events:{close:"CLOSE_SELECT2"}}).directive("dcmSelect2",["$q","$filter","$parse","SELECT2",function(e,n,t,a){return{restrict:"A",replace:!1,require:"ngModel",scope:!1,transclude:!1,compile:function(n){if(!n.is("input[type=hidden]"))throw'only <input type="hidden"> tags can have this attribute';return function(n,o,r,i){var l,u,s=r.idField||"id",c=r.textField||"text",d=r.iconField||"icon",g=r.modelSelected?t(r.modelSelected).assign:angular.noop,p=r.selectedOptGroup?t(r.selectedOptGroup).assign:angular.noop,m=r.selectedOptGroup?t(r.selectedOptGroup):angular.noop,f=r.optGroupIdField||"id",h={},v=function(){if(void 0===u){var e=t(r.data)(n);angular.isFunction(e)?(l=e(),u=!0):u=!1}return u?l:t(r.data)(n)},y=function(e){var n=[];return angular.forEach(e,function(e){e.hasOwnProperty(s)&&n.push(e),e.hasOwnProperty("children")&&angular.isArray(e.children)&&e.children.length&&n.push.apply(n,e.children)}),n},w=function(e,t){var a={objectData:null,idData:""},o=y(e);if(h.multiple){t=t?t:[];var r=[],i=[],l={};return angular.forEach(t,function(e){l[e.toString()]=!0}),angular.forEach(o,function(e){l.hasOwnProperty(e[s].toString())&&(r.push(e[s]),i.push(e))}),a.objectData=i,a.idData=r,a}return t=t?t:"",angular.forEach(o,function(e){return e[s].toString()===t.toString()?(p(n,e[f]),a.objectData=e,void(a.idData=t)):void 0}),a},b=function(e){return e?angular.isArray(e)&&0===e.length?!0:!1:!0},$={dropdownAutoWidth:!1,width:"off",query:function(t){e.when(v()).then(function(e){var a=[];if(e||(e=[]),t.term&&""!==t.term){var o=t.term.toLowerCase();angular.forEach(e,function(e){var n=angular.copy(e),t=!1,r=n.children;n.children=[],-1!==n[c].toString().toLowerCase().indexOf(o)&&(t=!0),r&&angular.isArray(r)&&angular.forEach(r,function(e){-1!==e[c].toString().toLowerCase().indexOf(o)&&(t=!0,n.children.push(e))}),t&&a.push(n)})}else a=e.slice(0);var r=m(n);if(r){var i={};i[f]=r;var l=_.findWhere(a,i);if(l){var u=_.indexOf(a,l);a.splice(u,1),a.splice(0,0,l)}}t.callback({more:!1,results:a})})},formatResult:function(e,n,t,a){var o=[];window.Select2.util.markMatch(e[c],t.term,o,a);var r=o.join("");return e[d]&&(r='<i class="select2-inline-icon '+e[d]+'"></i> '+r),r},formatSelection:function(e,n,t){var a=t(e[c]);return e[d]&&(a='<i class="select2-inline-icon '+e[d]+'"></i> '+a),a},id:function(e){return e[s]},initSelection:function(a,o){var l=n.$eval(r.ngModel);e.when(v()).then(function(e){var a=w(e,l);o(a.objectData),i.$viewValue=a.idData,g(n,a.objectData),b(a.idData)&&t(r.ngModel).assign(n,a.idData)})},formatSearching:function(){return"Loading..."}};angular.extend(h,$,n.$eval(r.dcmSelect2)),o.select2(h),o.on("change",function(e){n.$apply(function(){i.$setViewValue(e.val),t(r.ngModel).assign(n,e.val),g(n,o.select2("data")),r.sticky&&t(r.sticky).assign(n,e.val)})}),r.$observe("disabled",function(e){o.select2("enable",!e)}),r.$observe("readonly",function(e){o.select2("readonly",!!e)}),n.$watch(t(r.ngModel),function(e){if(b(e)){var a=h.multiple?[]:"";angular.equals(e,a)||t(r.ngModel).assign(n,a),o.select2("data",a,!1),g(n,a)}else r.sticky&&t(r.sticky).assign(n,e),o.select2("val",e,!1)}),r.modelSelected&&n.$watch(t(r.modelSelected),function(e){if(!angular.equals(e,o.select2("data"))){o.select2("data",e,!1);var a=o.select2("val");i.$viewValue=a,t(r.ngModel).assign(n,a)}}),n.$watchCollection(v,function(a){var l=o.select2("val");(r.sticky||!b(l))&&e.when(a).then(function(e){var a,u=l;r.sticky&&b(l)&&(u=t(r.sticky)(n)),a=w(e,u),angular.equals(l,a.idData)||(o.select2("data",a.objectData,!1),g(n,a.objectData),i.$viewValue=a.idData,t(r.ngModel).assign(n,a.idData))})}),n.$on("$destroy",function(){o.select2("destroy")}),n.$on(a.events.close,function(){o.select2("close")})}}}}]);
//# sourceMappingURL=dcm-ui-select2.min.js.map